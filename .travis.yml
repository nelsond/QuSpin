language: python
python: 3.7

jobs:
  include:
    - name: "Python 3.7 on mac OS"
      os: osx
      language: shell
      env:
        - USE_LIBOMP=true
    - name: "Python 3.7 on mac OS"
      os: osx
      language: shell
      env:
        - USE_LIBOMP=false

env:
  - USE_LIBOMP=true
  - USE_LIBOMP=false

addons:
  apt:
    packages:
      - libomp-dev
      - libgmp-dev
      - libmpfr-dev
      - libmpc-dev
      - libboost-dev

before_install:
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then brew update ; fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then brew install llvm libomp gmp pyenv 2>/dev/null || true; fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then pyenv install 3.7.0 && pyenv global 3.7.0 && pyenv local 3.7.0; fi  
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then export PATH=/usr/local/opt/llvm/bin:$PATH; fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then which python; fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then which python3; fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then which pip; fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then which pip3; fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then python --version; fi
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then python3 --version; fi

install:
  - pip3 install -r requirements.txt
  - if [ "$USE_LIBOMP" = true ]; then python3 setup.py install --omp; else python3 setup.py install; fi

script:
  - sh run_all_tests.sh
